<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linguist Engine - Debug Mode</title>
    <style>
        :root {
            --bg-color: #f4f1ea;
            --primary-green: #7da08a;
            --accent-peach: #e5b39b;
            --text-dark: #1e272e;
            --border-val: 3px solid #1e272e;
            --shadow-val: 6px 6px 0px #1e272e;
        }

        * { box-sizing: border-box; font-family: sans-serif; }
        body { background-color: var(--bg-color); color: var(--text-dark); padding: 20px; margin: 0; }
        .container { max-width: 800px; margin: 0 auto; }
        .brutalist-box { background: white; border: var(--border-val); box-shadow: var(--shadow-val); padding: 20px; margin-bottom: 25px; }
        input, textarea, button { width: 100%; padding: 15px; margin-top: 10px; border: var(--border-val); font-size: 1.1rem; outline: none; }
        button { background-color: var(--primary-green); color: white; font-weight: bold; cursor: pointer; }
        
        /* Debug Console Style */
        .debug-console {
            background: #2d3436;
            color: #fab1a0;
            font-family: monospace;
            padding: 15px;
            margin-top: 20px;
            font-size: 0.8rem;
            direction: ltr;
            text-align: left;
            border: 2px solid #ff7675;
            overflow-x: auto;
        }
        
        .status { font-weight: bold; margin-top: 10px; color: var(--primary-green); display: none; }
    </style>
</head>
<body>

<div class="container">
    <div class="brutalist-box" style="background: #eee;" dir="ltr">
        <label>GEMINI API KEY:</label>
        <input type="password" id="apiKey" placeholder="Enter API Key...">
    </div>

    <div class="brutalist-box">
        <h1>کالبدشکافی سیستم</h1>
        <textarea id="userInput" rows="3" placeholder="متن خود را اینجا بنویسید..."></textarea>
        <button onclick="startEngineering()">تحلیل فنی</button>
        <div id="statusLabel" class="status">در حال برقراری جریان داده...</div>
    </div>

    <div class="brutalist-box" style="border-color: #ff7675;">
        <h2 style="font-size: 1rem; color: #d63031;">گزارش فنی موتور (Debug Log)</h2>
        <div id="debugLog" class="debug-console">منتظر شروع عملیات...</div>
    </div>
</div>

<script>
    function logDebug(message) {
        const log = document.getElementById('debugLog');
        log.innerHTML += `<br>> ${message}`;
    }

    async function startEngineering() {
        const key = document.getElementById('apiKey').value;
        const text = document.getElementById('userInput').value;
        const status = document.getElementById('statusLabel');
        const debugLog = document.getElementById('debugLog');

        if(!key || !text) return alert("ورودی‌ها کامل نیست.");

        debugLog.innerHTML = "شروع تحلیل فیزیکی لایه شبکه...";
        status.style.display = "block";

        const prompt = `Analyze this Persian sentence and return JSON: "${text}"`;

        try {
            logDebug("در حال ارسال درخواست به گوگل...");
            
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    contents: [{ parts: [{ text: prompt }] }]
                })
            });

            logDebug(`کد پاسخ سرور: ${response.status} (${response.statusText})`);

            if (!response.ok) {
                const errorData = await response.json();
                logDebug(`خطای API: ${JSON.stringify(errorData)}`);
                throw new Error(`Server responded with ${response.status}`);
            }

            const data = await response.json();
            logDebug("پاسخ با موفقیت دریافت شد!");
            console.log(data);
            alert("موفقیت! پاسخ در کنسول چاپ شد.");

        } catch (e) {
            logDebug(`!!! شکست در سیستم !!!`);
            logDebug(`نوع خطا: ${e.name}`);
            logDebug(`پیام خطا: ${e.message}`);
            logDebug(`نکته: اگر پیام 'Failed to fetch' است، یعنی اینترنت شما دسترسی به گوگل را مسدود کرده است.`);
        } finally {
            status.style.display = "none";
        }
    }
</script>

</body>
</html>
